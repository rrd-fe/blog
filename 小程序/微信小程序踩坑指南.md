## å¾®ä¿¡å°ç¨‹åºé™(å°)å¦–ä¼(å°)é­”ç¯‡

> å¼€å‘å°±æ˜¯ä¸€ä¸ªè¥¿è¡Œå–ç»çš„è¿‡ç¨‹ï¼ŒæœŸé—´ä¸æ˜¯ä¸€å¸†é£é¡ºï¼Œä¸å®šä¼šé‡åˆ°ä»€ä¹ˆé¬¼ã€‚
> 
> æœ€è¿‘å¼€å‘ä¸€ä¸ªç®€å•çš„æ¯æ—¥ç­”é¢˜ç­¾åˆ°å°ç¨‹åºï¼ŒæœŸé—´é‡åˆ°ä¸€äº›å§‹æ–™æœªåŠçš„å‘è®°å½•ä¸€ä¸‹ï¼Œé¿å…æ—¥åé‡å¤è¸©å‘ã€‚æœ¬æ–‡é’ˆå¯¹åˆå…¥å°ç¨‹åºçš„å°ç™½ã€‚:)
> 
> å¯èƒ½ä¼šæœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿æŒ‡æ­£ã€‚


**å¤šå¼ gifå›¾é¢„è­¦ï¼Œå¤§æ¦‚20M ğŸ˜±**

### ç¬¬ä¸€éš¾: scroll-viewæ ‡ç­¾å¯¹dispay:flexæ— æ•ˆ

æƒ³è¦å®ç°ä¸€ä¸ªæ¨ªå‘æ»šåŠ¨çš„æ—¥å†ï¼Œå¾ˆè‡ªç„¶çš„æƒ³åˆ°scroll-viewç»„ä»¶ï¼Œäºæ˜¯æ´‹æ´‹æ´’æ´’çš„å†™ä¸‹å‡ è¡Œä»£ç :

demo.wxml

```
<scroll-view
        scroll-x="true"
        class="scroll-view-demo"
>
    <view class="item" wx:for="{{[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}}" wx:key="{{index}}">
        {{item}}
    </view>
</scroll-view>
```

demo.scss(ä¸ºäº†å†™ç€æ–¹ä¾¿ï¼Œè¯·è‡ªè¡Œè½¬æ¢æˆwxssè¯­æ³•ï¼Œä¸‹åŒ)

```
page {
  width: 100%;
  height: 100%;
  background: #17448E;
}
.scroll-view-demo {
  display: flex;
  flex-direction: row;
  .item {
    width: 80rpx;
    height: 80rpx;
    border: solid 1px #fff;
    display: flex;
    color: #fff;
    font-size: 36rpx;
    justify-content: center;
    align-items: center;
    border-radius: 40rpx;
    margin-left: 50rpx;
  }
}
```

æ“æ“æ‰‹ï¼Œçœ‹çœ‹æ•ˆæœ

![image](./assets/scroll_view.png)

å°´å°¬,è¯´å¥½çš„æ¨ªå‘æ»šåŠ¨å‘¢ï¼Œæ˜æ˜`flex-direction: row;`å†™çš„æ¸…æ¸…æ¥šæ¥šæ˜æ˜ç™½ç™½ã€‚ã€‚

æ—¢ç„¶`scroll-view`å¯¹`flex`ä¸å‹å¥½ï¼Œé‚£æˆ‘åœ¨å­å…ƒç´ ä¸Šå†åŒ…è£¹ä¸€å±‚`view`ç»„ä»¶åº”è¯¥ä¸‡äº‹å¤§å‰äº†å§ï¼Œäºæ˜¯:

demo.wxml

```
<scroll-view
        scroll-x="true"
        class="scroll-view-demo"
>
    <view class="item-container">
        <view class="item" wx:for="{{[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}}" wx:key="{{index}}">
            {{item}}
        </view>
    </view>
</scroll-view>
```

demo.scss

```
.scroll-view-demo {
  .item-container {
    display: flex;
    flex-direction: row;
    .item {
      width: 80rpx;
      height: 80rpx;
      border: solid 1px #fff;
      display: flex;
      color: #fff;
      font-size: 36rpx;
      justify-content: center;
      align-items: center;
      border-radius: 40rpx;
      margin-left: 50rpx;
    }
  }
}
```
çœ‹çœ‹æ•ˆæœ:

![image](./assets/scroll_view_flex.gif)

ç„¶é¹…ã€‚ã€‚å¥½åƒä¸æ˜¯é‚£ä¹ˆå›äº‹ï¼Œå­å…ƒç´ æ€ä¹ˆå°±è¢«æŒ¤æˆèƒ¶å›Šäº†ã€‚ã€‚ ä»”ç»†ç ”ç©¶ä¸€ç•ªï¼Œéœ€è¦ç»™`.item-container`åŠ ä¸Šå›ºå®šçš„`width`æ‰è¡Œï¼Œç”šæ˜¯éº»çƒ¦ã€‚

ç®€å•ç‚¹ï¼Œå¼€å‘çš„æ–¹å¼ç®€å•ç‚¹ï¼Œæ—¢ç„¶`scroll-view`å¯¹`flex`å¦‚æ­¤é«˜å†·ï¼Œé‚£å°±æ¢ä¸€ç§æ–¹å¼:

demo.wxml

```
<scroll-view
        scroll-x="true"
        class="scroll-view-demo"
>
    <view class="item" wx:for="{{[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}}" wx:key="{{index}}">
        {{item}}
    </view>
</scroll-view>
```
demo.scss

```
.scroll-view-demo {
  width: 100%;
  white-space: nowrap;
  .item {
    width: 80rpx;
    height: 80rpx;
    line-height: 80rpx;
    text-align: center;
    border: solid 1px #fff;
    display: inline-block;
    color: #fff;
    font-size: 36rpx;
    border-radius: 40rpx;
    margin-left: 50rpx;
  }
```
æ•ˆæœ:

![image](./assets/scroll_view_ok.gif)

ä¸¤ä¸ªå­—ï¼Œæ¥è¿‘å®Œç¾ğŸ˜†
 
ä¸è¿‡ï¼Œåœ¨æ‰‹æœºä¸Šæµè§ˆ`scroll-view`ä¼šæœ‰ä¸€ä¸ª**æ»šåŠ¨æ¡**ï¼Œå¾ˆä¸‘æœ‰æœ¨æœ‰

äºæ˜¯æŒ‘ç¯å¤œè¯»ç¿»é˜…èµ„æ–™æ‰¾åˆ°è§£å†³æ–¹æ³•:

app.css

```
/*éšè—scroll-viewæ»šåŠ¨æ¡*/
::-webkit-scrollbar{
  width: 0;
  height: 0;
  color: transparent;
}
```

è¿™ä¸‹å¦¥å¦¥çš„äº†,

> å¹´è½»äººåˆ‡è®°ï¼Œ`scroll-view` å°½é‡ä¸ç”¨`flex`

#### ç¬¬äºŒéš¾: scroll-view è®¾ç½®scroll-leftæ— æ•ˆé—®é¢˜

ä»¥ä¸º`scroll-view`è¸©å®Œä¸€ä¸ªå‘å°±ç»“æŸäº†ä¹ˆï¼Œå›¾æ£®ç ´å›¾æ ·ã€‚

æƒ³ç»™`scroll-view`åœ¨é¡µé¢loadingç»“æŸåæ»šåŠ¨åˆ°æŸä¸€ä¸ªä½ç½®ï¼Œ
å¾ˆç®€å•ï¼Œé—­ç€çœ¼å†™ä»£ç :

demo.wxml

```
<scroll-view
            scroll-x="true"
            class="daily-check-calendar-scroll"
            scroll-left="{{scrollLeft}}"
        >
        <view class="item" wx:for="{{list}}" wx:key="{{index}}">
	        {{item}}
	    </view>
</scroll-view>
```
demo.js

```
Page({
	data: {
		scrollLeft: 100,
		list: []
	},
	onLoad(){
		setTimeout(()=>{
			//å‡è£…å¼‚æ­¥è·å–æ•°æ®
			this.setData({
				list: [1,2,3,4,5,6,7,8]
			});
		},1000);
	}
})
```
çœ‹æ•ˆæœï¼Œå‘ç°`scroll-view`å¸¦åœ¨åŸåœ°çº¹ä¸ä¸åŠ¨ã€‚æƒ†æ€…~

let me see see
ä»£ç ç¨ä½œæ”¹åŠ¨:

demo.js

```
Page({
	data: {
		scrollLeft: 0,
		list: []
	},
	onLoad(){
		setTimeout(()=>{
			//å‡è£…å¼‚æ­¥è·å–æ•°æ®
			this.setData({
				list: [1,2,3,4,5,6,7,8],
				scrollLeft: 100
			});
		},1000);
	}
})

```

**perfect** æœç„¶è¾¾åˆ°äº†é¢„æœŸï¼Œç»†æƒ³åŸå› :

* ä¸€èˆ¬åœ¨é¡µé¢åŠ è½½æ—¶æˆ‘ä»¬ä¼šè¯·æ±‚æ•°æ®,å¹¶æ¸²æŸ“åˆ—è¡¨, ä½†æ˜¯æˆ‘ä»¬åœ¨æ ‡ç­¾æˆ–è€…`data`ä¸­è®¾ç½®çš„`scroll-left`å€¼ä¼šåœ¨æ•°æ®æ¸²æŸ“å‰èµ‹å€¼.
* æ­¤æ—¶çš„`scroll-view`ä¸­è¿˜æ˜¯ç©ºçš„,æ‰€ä»¥`scroll-left`ä¸ä¼šç”Ÿæ•ˆ. æˆ‘ä»¬åº”è¯¥åœ¨æ•°æ®æ¸²æŸ“åˆ°`scroll-view`ä¸­ä»¥å,å†åŒæ­¥`scroll-left`çš„å€¼

#### ç¬¬ä¸‰éš¾: buttonè‡ªå®šä¹‰æ ·å¼ï¼Œæ— æ³•å»æ‰é»˜è®¤æ ·å¼

æƒ³å†™ä¸€ä¸ªè‡ªå®šä¹‰æ ·å¼çš„æŒ‰é’®ï¼Œso easy,ç»™æˆ‘ä¸€ç§’å†™å‡ºæ¥:

demo.wxml

```
<view class="button">è¶…æ–°è„±ä¿—çš„æŒ‰é’®</view>
<button>è¶…æ–°è„±ä¿—çš„æŒ‰é’®,too</button>
```

demo.scss

```
button,
.button {
  width: 500rpx;
  height: 88rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32rpx;
  background: #FE7437;
  color: #fff;
  border-radius: 44rpx;
  margin: 20rpx auto;
}
```

æ•ˆæœ:

![image](./assets/button.png)

çŒ›ä¸€çœ‹ï¼Œæ„Ÿè§‰ä¸èƒ½å†å®Œç¾äº†ï¼Œå®šç›ä¸€çœ‹ï¼Œæ€ä¹ˆè§‰å¾—`button`ç»„ä»¶å†™å‡ºæ¥çš„æŒ‰é’®ä¸æ˜¯é‚£ä¹ˆçº¯æ´ï¼Œæœ‰é˜´å½±ã€‚

å¾ˆè‡ªç„¶çš„å†åŠ è¡Œä»£ç :

demo.scss

```
border: none;
```

äº‹æƒ…å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œé˜´å½±ä¾ç„¶å™©æ¢¦èˆ¬å­˜åœ¨ã€‚
æœ‰å›°éš¾ï¼Œæ‰¾ç™¾åº¦ï¼Œæœä¸å…¶ç„¶å¤§ç¥ä»¬çš„å¥‡æŠ€æ·«å·§é¡ºåˆ©è§£å†³ï¼Œè´´ä¸Šå®Œæ•´ä»£ç :

demo.scss

```
button,
.button {
  width: 500rpx;
  height: 88rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32rpx;
  background: #FE7437;
  color: #fff;
  border-radius: 44rpx;
  margin: 20rpx auto;
  &::after{
    border-radius: 0;
    border: none;
  }
}
```

æ•ˆæœ:

![image](./assets/button-ok.png)

 ç®€ç›´ä¸¤ä¸ªæŒ‰é’®ä¸€æ¨¡ä¸€æ ·ã€‚

#### ç¬¬å››éš¾ è®©äººä¼¤ç¥çš„inputç»„ä»¶

å°ç¨‹åºå¼€å‘å…ä¸äº†è¦æœ‰ç™»å½•é¡µé¢ï¼Œäºæ˜¯å°±ç¦»ä¸å¼€`input`ç»„ä»¶ï¼Œä»£ç å°±ä¸è´´äº†ï¼Œå¸¸è§„æ“ä½œï¼Œç›´æ¥ä¸Šå›¾ã€‚

![input](./assets/input.gif)

çœ‹å›¾å¾ˆå®¹æ˜“å‘ç°å‡ ä¸ªé—®é¢˜:

1. åˆ‡æ¢`input`æ—¶ æ–‡å­—ä¼šé—ªåŠ¨
2. åˆ‡æ¢ä¸‹ä¸€ä¸ª`input`æ—¶ éœ€è¦å¤šæ¬¡æ‰èƒ½è·å–åˆ°ç„¦ç‚¹ï¼Œå¼¹å‡ºé”®ç›˜ã€‚
3. å¦‚æœåœ¨ä¸åŒçš„æ‰‹æœºä¸Šçœ‹ï¼Œä¼šå‘ç°å¯†ç æ¡†çš„é»‘ç‚¹å¤§å°ä¹Ÿä¸ä¸€è‡´

é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç™¾åº¦è°·æ­ŒæŒ–åœ°ä¸‰å°ºä¹Ÿæœ¨æœ‰æ‰¾åˆ°å¥½çš„è§£å†³åŠæ³•(å¯èƒ½æ˜¯æŒ–çš„ä¸å¤Ÿæ·± :()
ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ—¢ç„¶ä¸èƒ½è‡ªä¸»è·å–ç„¦ç‚¹ï¼Œé‚£æˆ‘ä»¬ç»“åˆå®˜æ–¹æ–‡æ¡£åŠ©å®ƒä¸€è‡‚ä¹‹åŠ›:

demo.wxml

```
<view class="account-main">
    <text class="account-title">ç™»å½•</text>
    <form class="login-form" bindsubmit="formSubmit">
        <view class="form-item {{selectName ? 'selected' : ''}}">
            <input type="text" value="{{username}}" focus="{{selectName}}" bindtap="handleName" bindinput="getUsername" placeholder-class="login-ipt-place" class="login-ipt" placeholder="æ‰‹æœºå·/é‚®ç®±" />
        </view>
        <view class="form-item {{selectPwd ? 'selected' : ''}}">
            <input type="text" value="{{password}}" focus="{{selectPwd}}" bindtap="handlePwd" bindinput='getPassword' placeholder-class="login-ipt-place"  maxlength="48" class="login-ipt pwd-ipt" placeholder="ç™»å½•å¯†ç " password="true" />
        </view>
        <button class="form-submit" form-type="submit">
            ç™»å½•
        </button>
    </form>
</view>
```

demo.scss

```
...
```

demo.js

```
Page({
    data: {
        username: '',
        password: '',
        selectName: true,
        selectPwd: false,
    },
    getUsername(e){
        //è·å–ç”¨æˆ·å
        this.setData({
            username: e.detail.value,
        });
    },
    getPassword(e){
        //è·å–å¯†ç 
        this.setData({
            password: e.detail.value,
        })
    },
    handleName(){
        this.setData({
            selectName: true,
            selectPwd: false,
        })
    },
    handlePwd(){
        this.setData({
            selectName: false,
            selectPwd: true,
        })
    }
});
```

çœ‹çœ‹æ•ˆæœ:

![input](./assets/input_ok.gif)

çœ‹ç€åƒæ˜¯å¥½å¤šäº† ğŸ˜†
æ€è€ƒ: è‹¥æ–‡æœ¬æ¡†ä¸æ­¢ä¸¤ä¸ªï¼Œæ€ä¹ˆå†™æ‰æ›´ä¼˜é›…ï¼Œå¦ï¼Œæ²¡æœ‰çœ‹åœ¨ä¸åŒæ‰‹æœºä¸Šçš„è¡¨ç°ã€‚

ç¬¬ä¸‰ä¸ªå…³äºå¯†ç é»‘ç‚¹å¤§å°çš„é—®é¢˜ æˆ‘ä¹Ÿæœ¨æœ‰è‰¯ç­– +_+

ä»¥ä¸‹æ˜¯ç½‘ä¸Šå¤§ä½¬ä»¬å…³äº`input`ç»„ä»¶bugçš„æ€»ç»“:

* `placeholder` æ–‡å­—ä¸ `input` çš„å€¼é‡å  æš‚æ— è§£å†³æ–¹æ³•

* è·å–ç„¦ç‚¹ å’Œ å¤±å»ç„¦ç‚¹ æ—¶ï¼Œå…‰æ ‡å’Œæ–‡å­—è·³åŠ¨ æš‚æ— è§£å†³æ–¹æ³•

* å½“ `input` è®¾ç½®ä¸ºå±…ä¸­å¯¹é½æ—¶ï¼Œå…‰æ ‡ä¼šå‡ºç°åœ¨å¥‡æ€ªçš„ä½ç½® æš‚æ— è§£å†³æ–¹æ³•

* `bindconfirm` äº‹ä»¶åœ¨å¤±å»ç„¦ç‚¹æ—¶ä¹Ÿä¼šè§¦å‘ï¼Œç±»ä¼¼äº `blur` æš‚æ— è§£å†³æ–¹æ³•

* å¯¹ `input` åšåŠ¨ç”»æ—¶ï¼Œå¦‚æœæ˜¯è·å–ç„¦ç‚¹çŠ¶æ€ï¼Œä¼šå¤±æ•ˆ æš‚æ— è§£å†³æ–¹æ¡ˆï¼Œå› ä¸º input åœ¨è·å–ç„¦ç‚¹æ—¶æ˜¯native ç»„ä»¶ï¼Œå¤±å»ç„¦ç‚¹åæ”¹å› web ç»„ä»¶

* `type` ä¸º `idcard`, `digit` æ—¶å¹¶ä¸æ˜¯è°ƒç”¨æ•°å­—é”®ç›˜ æš‚æ— è§£å†³æ–¹æ¡ˆï¼Œç›®å‰èµ·ä½œç”¨çš„åªæœ‰ `number`

* åœ¨`input`èšç„¦æœŸé—´ï¼Œä¸èƒ½åš`css`åŠ¨ç”»ï¼Œå¦åˆ™`input`ä¸­çš„`placeholder`ä¼šé”™ä½ï¼Œå¦‚æœåŠ¨ç”»å’Œèšç„¦éƒ½æƒ³è¦çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨åŠ¨ç”»å®Œæˆä¹‹åï¼Œå†è®¾ç½®èšç„¦

çœ‹çœ‹å¾®ä¿¡å®˜æ–¹ç¤¾åŒºçš„åæ§½ï¼Œå¦‚æœä½ ä¹Ÿè¢«å‘äº†ï¼Œå»ç»™åŠ©ä¸ªæ”»å§

![input](./assets/input.png)

[ä¼ é€é—¨](https://developers.weixin.qq.com/community/develop/doc/00006adff689980f46d67262651800?_at=1559133433615)

#### ç¬¬äº”éš¾ getPhoneNumberè·å–ç”¨æˆ·æ‰‹æœºå·è§£å¯†æŠ¥é”™é—®é¢˜

å°ç¨‹åºç™»å½•æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¾®ä¿¡è·å–æ‰‹æœºå·å¿«æ·ç™»å½•ï¼Œæ ¹æ®æ–‡æ¡£æˆ‘ä»¬å¾ˆå®¹æ˜“å†™ä¸€å¥—ç™»å½•æµç¨‹:

demo.wmxl

```
<button class="login-by-wx" open-type="getPhoneNumber"  bindgetphonenumber="getPhoneNumber">
    å¾®ä¿¡ç™»å½•
</button>
```

demo.js

```
Page({
	...
	async getPhoneNumber(e) {
		if(!e.detail.iv){
            //è¢«æ‹’ç»æˆæƒ
            return;
        }
        
        let code = '';
        
         /*
    	  * åˆ«æ…Œï¼ŒwxPromise.login()å…¶å®å°±æ˜¯wxçš„apiè¢«promiseåŒ–ï¼Œå‚è€ƒ **è½¬è½¬**ä»£ç 
    	  * https://github.com/zhuanzhuanfe/fancy-mini/blob/master/src/wxPromise.js
    	  */
    	  const res = await wxPromise.login();
    	  code = res.code;
    	  
    	  if(!code){
    	  	console.error(`è°ƒç”¨ wx.login å¤±è´¥`, err);
            return util.toast('å¾®ä¿¡ç™»å½•å¤±è´¥');
    	  }
        
        try{
        	//serverç«¯å¾®ä¿¡ç™»å½•æ¥å£
            const result = await service.passport.wxLogin({
                data: {
                    code: code,
                    iv: e.detail.iv,
                    encryptedData:  e.detail.encryptedData
                }
            });
            const res = result.data;
            if (res.status === 0) {
                // ç™»å½•æˆåŠŸ
               	...
            }else {
                ...
            }

        }catch(err){
           ...
        }
        
	}
	...
});

```

server.js

```
async wxLoginAction(){
	//å¾®ä¿¡ç™»å½•
        const {ctx} = this;
        const body = ctx.request.body;
        //è¯·æ±‚å¾®ä¿¡æ¥å£ https://api.weixin.qq.com/sns/jscode2session
        const result = await this.callService('wxApplet.code2Session', {
            appid: ***,
            secret: ***,
            js_code: body.code,
            grant_type: 'authorization_code'
        });
        
        if(result.status == 0){
        	let sessionKey = result.data.session_key;
            let encryptedData = body.encryptedData;
            let iv = body.iv;
            //è§£å¯†è·å–æ‰‹æœºå· (è§£å¯†åº“å°ç¨‹åºæ–‡æ¡£æœ‰å¯¹åº”çš„æºç )
            let pc = new WXBizDataCrypt(appid, sessionKey);
            let mobile = pc.decryptData(encryptedData, iv).phoneNumber;
            
            //è§£å¯†æˆåŠŸ ç”Ÿæˆç™»å½•æ€ç­‰æ“ä½œ
            ...
            
            return this.json({
            	status: 0,
            	message: 'ok',
            	data: mobile
            });
            
        }else {
        	....
        }
}
```

æ“æ“æ‰‹ï¼Œçœ‹æ•ˆæœ:

![login](./assets/login.gif)

ç«Ÿç„¶é¦–æ¬¡ç™»å½•çš„æ—¶å€™æœ‰æŠ¥é”™ï¼Œä»¥åå†æ¬¡ç™»å½•å´ä¸€åˆ‡æ­£å¸¸ã€‚

çœ‹serverç«¯æŠ¥é”™æ—¥å¿—ï¼Œå¦‚ä¸‹:

```
Error: error:06065064:digital envelope routines:EVP_DecryptFinal_ex:bad decrypt
```
è¿™æ¡`error`ä¿¡æ¯æ˜¯ä»`WXBizDataCrypt`è§£å¯†å¤±è´¥æ—¶æŠ›å‡ºæ¥çš„ã€‚

æŸ¥çœ‹æ–‡æ¡£ï¼Œçœ‹buttonçš„å®˜æ–¹æ–‡æ¡£Tipsä¸­æœ‰è¿™ä¸€æ¡:

> åœ¨bindgetphonenumber ç­‰è¿”å›åŠ å¯†ä¿¡æ¯çš„å›è°ƒä¸­è°ƒç”¨ wx.login ç™»å½•ï¼Œå¯èƒ½ä¼šåˆ·æ–°ç™»å½•æ€ã€‚æ­¤æ—¶æœåŠ¡å™¨ä½¿ç”¨ code æ¢å–çš„ sessionKey ä¸æ˜¯åŠ å¯†æ—¶ä½¿ç”¨çš„ sessionKeyï¼Œå¯¼è‡´è§£å¯†å¤±è´¥ã€‚å»ºè®®å¼€å‘è€…æå‰è¿›è¡Œ loginï¼›æˆ–è€…åœ¨å›è°ƒä¸­å…ˆä½¿ç”¨ checkSession è¿›è¡Œç™»å½•æ€æ£€æŸ¥ï¼Œé¿å… login åˆ·æ–°ç™»å½•æ€ã€‚

å¦å¤–ï¼ŒæŸ¥çœ‹ç½‘ä¸Šå¤§ç¥çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­æœ‰ä¸€æ¡æ˜¯è¿™æ ·è¯´çš„:

![login](./assets/login_error.png)

çº³å°¼ï¼Œç‚¹å‡»æŒ‰é’®ä¹‹å‰å°±è¦è°ƒç”¨`login`,äºæ˜¯å°†ä¿¡å°†ç–‘çš„å†æ¬¡ä¿®æ”¹ä»£ç :

demo.js

```
Page({
	data: {
		code: ''
	},
	async onLoad(options){
		try {
            const res = await wxPromise.login();
            this.setData({
                code: res.code
            })
        }catch (err){
            this.setData({
                code: ''
            })
        }
	},
	async getPhoneNumber(e) {
		if(!e.detail.iv){
            //è¢«æ‹’ç»æˆæƒ
            return;
        }
        let code = this.data.code;
        if(!code){
    	  	console.error(`è°ƒç”¨ wx.login å¤±è´¥`, err);
            return util.toast('å¾®ä¿¡ç™»å½•å¤±è´¥');
    	  }
        
        try{
        	//serverç«¯å¾®ä¿¡ç™»å½•æ¥å£
            const result = await service.passport.wxLogin({
                data: {
                    code: code,
                    iv: e.detail.iv,
                    encryptedData:  e.detail.encryptedData
                }
            });
            const res = result.data;
            if (res.status === 0) {
                // ç™»å½•æˆåŠŸ
               	...
            }else {
                ...
            }

        }catch(err){
           ...
        }
	}
});
```

ä¿®æ”¹å®Œæ¯•ï¼Œç»è¿‡æµ‹è¯•ï¼Œé¦–æ¬¡ç™»å½•æœç„¶å¾ˆé¡ºåˆ©å°±æˆåŠŸäº†ï¼Œä½†æ˜¯åˆå‡ºç°äº†ä¸€ä¸ªå¹ºè›¾å­ï¼Œå†æ¬¡ç™»å½•å°±åˆåˆåˆæŠ¥é”™:

```
error: code is used
```
è¿™ä¸ªæŠ¥é”™å°±å¾ˆå¥½ç†è§£äº†ï¼Œç¨ç¨ä¿®æ”¹ä¸€ä¸‹ä»£ç :

demo.js

```
Page({
	data: {
		code: ''
	},
	async onLoad(options){
		try {
            const res = await wxPromise.login();
            this.setData({
                code: res.code
            })
        }catch (err){
            this.setData({
                code: ''
            })
        }
	},
	async getPhoneNumber(e) {
		if(!e.detail.iv){
            //è¢«æ‹’ç»æˆæƒ
            return;
        }
        let code = this.data.code;
        
        if (!code) {
            //é˜²æ­¢codeå¤±æ•ˆ
            try{
                const res = await wxPromise.login();
                code = res.code;
            }catch(err){
                this.setData({
                    loading: false
                });
                console.error(`è°ƒç”¨ wx.login å¤±è´¥`, err);
                return util.toast('å¾®ä¿¡ç™»å½•å¤±è´¥');
            }
        }
        
        try{
        	//serverç«¯å¾®ä¿¡ç™»å½•æ¥å£
            const result = await service.passport.wxLogin({
                data: {
                    code: code,
                    iv: e.detail.iv,
                    encryptedData:  e.detail.encryptedData
                }
            });
            const res = result.data;
            
            this.setData({
                //ç”¨è¿‡çš„codeéœ€è¦æ¸…ç©ºï¼Œé‡æ–°è·å–
                code: ''
            });
            
            if (res.status === 0) {
                // ç™»å½•æˆåŠŸ
               	...
            }else {
                ...
            }

        }catch(err){
           ...
        }
	}
});
```
æ³ªæµæ»¡é¢ï¼Œè‡ªæˆ‘æµ‹è¯•ï¼Œç¡®å®ç»å¾—èµ·ç»„ç»‡è€ƒéªŒï¼Œå®Œç¾è§£å†³ã€‚(ä¹Ÿå¯èƒ½æµ‹è¯•çš„ä¸å¤Ÿé€å½»ï¼Œå¦‚æœè¿˜æœ‰æŠ¥é”™ï¼Œæˆ–è€…æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿æ‰“è„¸T T)

#### ç¬¬å…­éš¾ åˆ·æ–°é¡µé¢å›¾ç‰‡åŠ è½½æ—¶å˜å½¢é—®é¢˜

`image`ç»„ä»¶å¼€å‘æ—¶ç‰¹åˆ«å¸¸è§ï¼Œè¦å†™ä¸€ä¸ªå®½åº¦å›ºå®šï¼Œé«˜åº¦è‡ªé€‚åº”ä»£ç ä¹Ÿå¾ˆç®€å•:

demo.wxml

```
<image
    mode = "widthFix"
    src="ä½ çš„å›¾ç‰‡åœ°å€"
>
</image>
```
çœ‹ç€å¾ˆç®€å•ï¼Œæ„Ÿè§‰ç¨³ç¨³åœ°ï¼Œä½†æ˜¯åˆ·æ–°é¡µé¢æ—¶ä¼šæœ‰ä¸­è§é¬¼çš„èµ¶è„šï¼Œè¯ä¸å¤šè¯´ä¸Šå›¾:

![input](./assets/image.gif)

ä»”ç»†çœ‹ä¼¼ä¹æœ‰é¬¼å½±æ è¿‡ã€‚ã€‚ã€‚ åŠ è½½æ—¶å›¾ç‰‡è¢«æ‹‰æ‰¯å˜å½¢ï¼ŒğŸ˜±

å…¶å®è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š

demo.scss

```
image {
	height: auto;
}
```

å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå°±å®Œç¾è§£å†³ã€‚åˆ«é—®ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¹Ÿæœ¨çŸ¥ã€‚ ğŸ˜†


ä»¥ä¸Šã€‚

å¼€å‘æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œå‰é¢æœªçŸ¥çš„å‘è¿˜å¾ˆå¤šã€‚ç«æ¥æ°´æŒ¡æ°´æ¥åœŸæ©ï¼Œå¡«çš„å‘è¶Šå¤šï¼Œè·¯ä¼šè¶Šå¹³å¦ï¼Œå†æ”’ä¸€æ³¢å‘ï¼Œç­‰ä¸‹æ¬¡æ›´æ–°ã€‚

æœ€åæ’æ’­ä¸€æ¡å¹¿å‘Šï¼Œç»è¿‡ä¸€å¤©å¤šæ¬¡è¢«æ‹’åï¼Œå°ç¨‹åºç»ˆäºå®¡æ ¸é€šè¿‡äº†(æ„Ÿè°¢å„ç§TV T T),æ¬¢è¿ä½“éªŒåæ§½

![input](./assets/rrd.jpg)

****

å‚è€ƒæ–‡ç« :

* [å¾®ä¿¡å°ç¨‹åºä¹‹scroll-viewçš„flexå¸ƒå±€é—®é¢˜](https://segmentfault.com/a/1190000017898725)
* [å°ç¨‹åºå¼€å‘ä¸­çš„é‚£äº›å°å‘](https://segmentfault.com/a/1190000016008005)
* [å¾®ä¿¡å…¬ä¼—å·/å°ç¨‹åºå¼€å‘é…ç½®å¸¸è§é”™è¯¯ä¿¡æ¯](https://segmentfault.com/a/1190000012303245)

 
å°ç¨‹åºé‡Œçš„ç™»å½•æ€å¤„ç†ï¼Œä¸»è¦å‚è€ƒä»¥ä¸‹æ–‡ç« (å…·ä½“å®ç°çœç•¥):

* [å¥å£®é«˜æ•ˆçš„å°ç¨‹åºç™»å½•æ–¹æ¡ˆ](https://mp.weixin.qq.com/s/tjXbkikQU9q7cMuA4wldfQ)
* [å¾®ä¿¡å°ç¨‹åºä¹‹ç™»å½•æ€çš„æ¢ç´¢](https://zhuanlan.zhihu.com/p/56439292)
* [å½»åº•ææ‡‚å°ç¨‹åºç™»å½•æµç¨‹-é™„å°ç¨‹åºå’ŒæœåŠ¡ç«¯ä»£ç ](https://juejin.im/post/5bda7bfb6fb9a02228233f45)